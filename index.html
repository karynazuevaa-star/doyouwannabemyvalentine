<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>–í–∞–ª–µ–Ω—Ç–∏–Ω–∫–∞ üíò</title>

  <style>
    :root{
      --bg:#3a0b16;
      --bg2:#19050b;
      --ink:#2b0a10;
      --accent:#ff4d6d;
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      height:100vh;
      overflow:hidden;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(1100px 600px at 20% 15%, rgba(255,255,255,0.06), transparent 60%),
        radial-gradient(900px 550px at 85% 70%, rgba(255,255,255,0.05), transparent 55%),
        linear-gradient(135deg, var(--bg), var(--bg2));
    }

    /* –ø–∞–¥–∞—é—â–∏–µ —Å–µ—Ä–¥–µ—á–∫–∏ */
    #hearts{ position:fixed; inset:0; pointer-events:none; z-index:0; overflow:hidden; }
    .heart{
      position:absolute;
      top:-12vh;
      user-select:none;
      opacity:0.95;
      filter: drop-shadow(0 8px 14px rgba(0,0,0,0.25));
      animation: fall linear forwards;
    }
    @keyframes fall{
      0%{ transform: translateY(-12vh) rotate(0deg); opacity:0; }
      10%{ opacity:0.95; }
      100%{ transform: translateY(115vh) rotate(360deg); opacity:0; }
    }

    .stage{
      position:relative;
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:1;
    }

    /* –ù–ï —Å—Ç–∞–≤–∏–º filter/transform –Ω–∞ wrap ‚Äî —Ñ–∏–∫—Å –¥–ª—è iOS fixed */
    .wrap{
      position:relative;
      width:min(980px, 96vw);
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .card{
      position:relative;
      width:100%;
      padding:34px 28px 26px;
      text-align:center;
      color:var(--ink);
      border-radius:28px;
      background: linear-gradient(#ffffff, #fff6fb);
      box-shadow:
        inset 0 0 0 2px rgba(255,77,109,0.10),
        0 22px 60px rgba(0,0,0,0.25);
      z-index:2;
      overflow:hidden;
    }

    h1{
      margin:0 0 16px;
      font-size: clamp(22px, 4.6vw, 34px);
      line-height:1.15;
    }

    .btnrow{
      display:flex;
      gap:12px;
      justify-content:center;
      flex-wrap:wrap;
      margin-top:10px;
      position:relative;
      z-index:5;
    }

    button{
      font-size:18px;
      padding:12px 22px;
      border:none;
      border-radius:14px;
      cursor:pointer;
      user-select:none;
      touch-action: manipulation;
      transition: transform .12s ease, filter .12s ease;
    }
    button:active{ transform: translateY(1px) scale(0.99); }

    #yes{
      background: var(--accent);
      color:#fff;
      font-weight:900;
      box-shadow: 0 10px 22px rgba(255,77,109,0.25);
    }

    /* –º–µ—Å—Ç–æ –¥–ª—è "–Ω–µ—Ç" —Ä—è–¥–æ–º —Å "–¥–∞" */
    #noSlot{
      background:#e7e0e6;
      color:#3b1a22;
      font-weight:900;
      visibility:hidden;
    }

    #message{
      margin:12px 0 0;
      min-height: 24px;
      font-size:16px;
      color:#8a0a26;
      position:relative;
      z-index:5;
    }

    /* —Ö–æ–º—è—á–∫–∏ –≤—ã–≥–ª—è–¥—ã–≤–∞—é—Ç */
    .peek-zone{
      position:absolute;
      inset:0;
      pointer-events:none;
      z-index:1;
      overflow:hidden;
      border-radius:28px;
    }
    .ham{
      position:absolute;
      width:92px; height:92px;
      image-rendering: pixelated;
      filter: drop-shadow(0 12px 18px rgba(0,0,0,0.22));
      opacity:0;
      transform: translateY(46px);
      animation: peek 4.2s ease-in-out infinite;
    }
    .ham.h2{ width:80px; height:80px; animation-delay: .9s; animation-duration: 4.7s; }
    .ham.h3{ width:70px; height:70px; animation-delay: 1.6s; animation-duration: 3.9s; }
    @keyframes peek{
      0%, 35%   { opacity:0; transform: translateY(46px); }
      45%, 75%  { opacity:1; transform: translateY(0px); }
      85%, 100% { opacity:0; transform: translateY(46px); }
    }

    /* –†–µ–∞–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ "–ù–µ—Ç" ‚Äî –≤—Å–µ–≥–¥–∞ –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ */
    #noFly{
      position:fixed;
      left:-9999px;
      top:-9999px;
      z-index:2147483647;
      background:#e7e0e6;
      color:#3b1a22;
      font-weight:900;
      display:inline-block;
      opacity:1;
      visibility:visible;
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
      transform: translateZ(0);
      will-change: left, top;
    }

    /* —Ñ–µ–π–µ—Ä–≤–µ—Ä–∫–∏ */
    #fw{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:10;
      display:none;
    }

    /* ---------- –§–ò–ù–ê–õ: –¢–ï–ö–°–¢ –°–õ–ï–í–ê/–°–ü–†–ê–í–ê + –§–û–¢–û –ü–û –¶–ï–ù–¢–†–£ ---------- */
    .final-screen{
      position:relative;
      height:100vh;
      width:100vw;
      overflow:hidden;
    }

    /* —Ñ–æ—Ç–æ: —á—É—Ç—å –ë–û–õ–¨–®–ï, –Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–µ –Ω–∞–µ–∑–∂–∞–µ—Ç –Ω–∞ —Ç–µ–∫—Å—Ç
       ‚Äî —Å—Ç–∞–≤–∏–º "–∫–æ—Ä–∏–¥–æ—Ä" –ø–æ —Ü–µ–Ω—Ç—Ä—É —á–µ—Ä–µ–∑ clamp */
    .final-photo{
      position:absolute;
      left:50%;
      bottom: calc(-36px - env(safe-area-inset-bottom));
      transform: translateX(-50%) scale(0.10);
      transform-origin: center bottom;
      width: clamp(420px, 38vw, 560px); /* –ë–û–õ–¨–®–ï */
      height:auto;
      opacity: 0;
      animation: photoGrow .9s cubic-bezier(.2,.9,.25,1) forwards;
      filter: drop-shadow(0 22px 60px rgba(0,0,0,0.35));
      z-index:10;
      pointer-events:none;
    }
    @keyframes photoGrow{
      to{ transform: translateX(-50%) scale(1); opacity:1; }
    }

    /* —Ç–µ–∫—Å—Ç –ø–æ –±–æ–∫–∞–º */
    .final-text{
      position:absolute;
      top:40%;
      transform: translateY(-50%);
      color:#fff;
      font-weight:900;
      line-height:1.12;
      text-shadow: 0 10px 30px rgba(0,0,0,.6);
      font-size: clamp(26px, 2.8vw, 44px);
      z-index:12;
      padding: 0 10px;
    }

    /* –í–ê–ñ–ù–û: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π "–∫–æ—Ä–∏–¥–æ—Ä" –ø–æ —Ü–µ–Ω—Ç—Ä—É –ø–æ–¥ —Ñ–æ—Ç–æ:
       - —Å–ª–µ–≤–∞ —Ç–µ–∫—Å—Ç –∑–∞–Ω–∏–º–∞–µ—Ç –ª–µ–≤—É—é —á–∞—Å—Ç—å –¥–æ –∫–æ—Ä–∏–¥–æ—Ä–∞
       - —Å–ø—Ä–∞–≤–∞ —Ç–µ–∫—Å—Ç ‚Äî –ø—Ä–∞–≤—É—é —á–∞—Å—Ç—å –æ—Ç –∫–æ—Ä–∏–¥–æ—Ä–∞ */
    .final-text.left{
      left:6%;
      right: calc(50% + clamp(220px, 19vw, 280px)); /* –æ—Ç—Å—Ç—É–ø –ø–æ–¥ —Ñ–æ—Ç–æ */
      text-align:right;
    }
    .final-text.right{
      right:6%;
      left:  calc(50% + clamp(220px, 19vw, 280px)); /* –æ—Ç—Å—Ç—É–ø –ø–æ–¥ —Ñ–æ—Ç–æ */
      text-align:left;
    }

    /* üì± –º–æ–±–∏–ª–∫–∞ ‚Äî –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ —Å–≤–µ—Ä—Ö—É, —Ñ–æ—Ç–æ —Å–Ω–∏–∑—É */
    @media (max-width: 700px){
      .final-photo{
        width: 86vw;
        bottom: calc(-18px - env(safe-area-inset-bottom));
      }
      .final-text{
        width: 92vw;
        left:50%;
        right:auto;
        transform: translate(-50%, 0);
        text-align:center;
        font-size: clamp(32px, 8.6vw, 52px);
      }
      .final-text.left{ top: 16%; }
      .final-text.right{ top: 30%; left:50%; }
    }
  </style>
</head>

<body>
  <div id="hearts" aria-hidden="true"></div>
  <canvas id="fw"></canvas>

  <!-- –ù–∞—Å—Ç–æ—è—â–∞—è "–ù–µ—Ç" (–≤–Ω–µ –∫–∞—Ä—Ç–æ—á–∫–∏) -->
  <button id="noFly">–ù–µ—Ç</button>

  <div class="stage" id="stage">
    <div class="wrap" id="wrap">
      <div class="card">

        <div class="peek-zone" aria-hidden="true">
          <img class="ham h1" src="./hamster.png" alt="" style="left:-12px; bottom:-18px;">
          <img class="ham h2" src="./hamster.png" alt="" style="left:50%; bottom:-22px; transform: translate(-50%, 46px);">
          <img class="ham h3" src="./hamster.png" alt="" style="right:-16px; bottom:-20px;">
        </div>

        <h1>–ë—É–¥–µ—à—å –ª–∏ —Ç—ã –º–æ–µ–π –≤–∞–ª–µ–Ω—Ç–∏–Ω–∫–æ–π? üíò</h1>

        <div class="btnrow">
          <button id="yes">–î–∞ ‚ù§Ô∏è</button>
          <button id="noSlot" aria-hidden="true">–ù–µ—Ç</button>
        </div>

        <div id="message"></div>
      </div>
    </div>
  </div>

  <script>
    /* ---------- –°–µ—Ä–¥–µ—á–∫–∏ ---------- */
    const heartsBox = document.getElementById('hearts');
    const heartChars = ["‚ù§","üíó","üíñ","üíò","üíû"];
    function spawnHeart(){
      const h = document.createElement('div');
      h.className = 'heart';
      h.textContent = heartChars[Math.floor(Math.random()*heartChars.length)];
      h.style.left = (Math.random()*100) + "vw";
      h.style.fontSize = (14 + Math.random()*18) + "px";
      const dur = 7 + Math.random()*7;
      h.style.animationDuration = dur + "s";
      heartsBox.appendChild(h);
      setTimeout(()=>h.remove(), (dur+1)*1000);
    }
    setInterval(spawnHeart, 230);
    for(let i=0;i<18;i++) setTimeout(spawnHeart, i*120);

    /* ---------- –ö–Ω–æ–ø–∫–∞ "–ù–µ—Ç" ---------- */
    const noFly = document.getElementById("noFly");
    const noSlot = document.getElementById("noSlot");
    const message = document.getElementById("message");

    let started = false;
    const PAD = 14;
    const TRIGGER = 190;
    const SPEED_BOOST = 1.18;

    let pos = { x: 0, y: 0 };
    let vel = { x: 0, y: 0 };
    let cursor = { x: window.innerWidth/2, y: window.innerHeight/2 };

    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
    function bounds(){
      const w = noFly.offsetWidth;
      const h = noFly.offsetHeight;
      return {
        minX: PAD,
        minY: PAD,
        maxX: window.innerWidth  - w - PAD,
        maxY: window.innerHeight - h - PAD
      };
    }

    function snapToSlot(){
      const r = noSlot.getBoundingClientRect();
      pos.x = r.left;
      pos.y = r.top;
      noFly.style.left = pos.x + "px";
      noFly.style.top  = pos.y + "px";
    }

    function startRun(){
      if (started) return;
      snapToSlot();
      vel.x = (Math.random()*2 - 1) * 10 * SPEED_BOOST;
      vel.y = (Math.random()*2 - 1) * 10 * SPEED_BOOST;
      started = true;
    }

    function maybeStart(){
      if (started) return;
      const r = noSlot.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top  + r.height/2;
      const d = Math.hypot(cx - cursor.x, cy - cursor.y);
      if (d < TRIGGER) startRun();
    }

    document.addEventListener("mousemove", (e) => {
      cursor.x = e.clientX;
      cursor.y = e.clientY;
      maybeStart();
    });

    document.addEventListener("touchmove", (e) => {
      const t = e.touches[0];
      cursor.x = t.clientX;
      cursor.y = t.clientY;
      maybeStart();
    }, {passive:true});

    noFly.addEventListener("mouseenter", startRun);
    noFly.addEventListener("touchstart", (e) => { startRun(); e.preventDefault(); }, {passive:false});

    function keepInsideScreen(){
      if (!started) return;
      const b = bounds();
      pos.x = clamp(pos.x, b.minX, b.maxX);
      pos.y = clamp(pos.y, b.minY, b.maxY);
      noFly.style.left = pos.x + "px";
      noFly.style.top  = pos.y + "px";
    }

    function step(){
      if (!started){
        snapToSlot();
        requestAnimationFrame(step);
        return;
      }

      const w = noFly.offsetWidth, h = noFly.offsetHeight;
      const bx = pos.x + w/2, by = pos.y + h/2;

      vel.x += (Math.random()*2 - 1) * 0.55 * SPEED_BOOST;
      vel.y += (Math.random()*2 - 1) * 0.55 * SPEED_BOOST;

      const dx = bx - cursor.x;
      const dy = by - cursor.y;
      const dist = Math.hypot(dx, dy);

      if (dist < TRIGGER){
        const nx = dx / (dist || 1);
        const ny = dy / (dist || 1);
        const strength = (TRIGGER - dist) / TRIGGER;

        const accel = (2.8 + strength * 10.2) * SPEED_BOOST;
        vel.x += nx * accel;
        vel.y += ny * accel;

        const perpX = -ny, perpY = nx;
        const side = (Math.random() < 0.5 ? -1 : 1);
        vel.x += perpX * side * (1.0 + strength * 2.2) * SPEED_BOOST;
        vel.y += perpY * side * (1.0 + strength * 2.2) * SPEED_BOOST;
      }

      vel.x *= 0.90;
      vel.y *= 0.90;

      const vmax = 28 * SPEED_BOOST;
      vel.x = clamp(vel.x, -vmax, vmax);
      vel.y = clamp(vel.y, -vmax, vmax);

      pos.x += vel.x;
      pos.y += vel.y;

      const b = bounds();
      if (pos.x < b.minX){ pos.x = b.minX; vel.x = Math.abs(vel.x) * 0.92; }
      if (pos.x > b.maxX){ pos.x = b.maxX; vel.x = -Math.abs(vel.x) * 0.92; }
      if (pos.y < b.minY){ pos.y = b.minY; vel.y = Math.abs(vel.y) * 0.92; }
      if (pos.y > b.maxY){ pos.y = b.maxY; vel.y = -Math.abs(vel.y) * 0.92; }

      pos.x = clamp(pos.x, b.minX, b.maxX);
      pos.y = clamp(pos.y, b.minY, b.maxY);

      noFly.style.left = pos.x + "px";
      noFly.style.top  = pos.y + "px";

      requestAnimationFrame(step);
    }
    requestAnimationFrame(step);

    window.addEventListener("resize", keepInsideScreen);
    window.addEventListener("orientationchange", () => setTimeout(keepInsideScreen, 250));

    noFly.addEventListener("click", () => {
      message.textContent = "–¥–æ—Ä–æ–≥–æ–π –≤–∏—Ç–∞–ª–∏–∫, —Ç—ã –∑–∞–±—ã–ª —Å –∫–µ–º –∂–∏–≤–µ—à—å. —Ç—É—Ç –Ω–µ—Ç –≤—ã–±–æ—Ä–∞. –ø–æ–¥—É–º–∞–π –µ—â–µ —Ä–∞–∑ :)";
    });

    /* ---------- –§–µ–π–µ—Ä–≤–µ—Ä–∫–∏ ---------- */
    const yesBtn = document.getElementById("yes");
    const stage = document.getElementById("stage");
    const wrap = document.getElementById("wrap");
    const fw = document.getElementById("fw");
    const ctx = fw.getContext("2d");

    const isMobile = matchMedia("(pointer: coarse)").matches || window.innerWidth < 700;
    let particles = [];

    function resizeFW(){
      fw.width = window.innerWidth;
      fw.height = window.innerHeight;
    }

    function burst(x,y){
      const count = isMobile ? 70 : 120;
      for(let i=0;i<count;i++){
        const a = Math.random()*Math.PI*2;
        const s = (isMobile ? 3.6 : 2.8) + Math.random()*(isMobile ? 7.6 : 6.8);
        particles.push({
          x,y,
          vx: Math.cos(a)*s,
          vy: Math.sin(a)*s,
          life: (isMobile ? 55 : 80) + Math.random()*(isMobile ? 25 : 35),
          r: (isMobile ? 2.2 : 2) + Math.random()*(isMobile ? 2.4 : 2.5),
          hue: Math.random()*360
        });
      }
    }

    function tickFW(){
      if (fw.style.display === "none") return;

      ctx.clearRect(0,0,fw.width,fw.height);

      const decay = isMobile ? 1.35 : 1.0;
      particles = particles.filter(p => p.life > 0);

      for(const p of particles){
        p.life -= decay;
        p.vy += isMobile ? 0.07 : 0.05;
        p.vx *= 0.99;
        p.vy *= 0.99;
        p.x += p.vx;
        p.y += p.vy;

        ctx.beginPath();
        ctx.fillStyle = `hsla(${p.hue}, 95%, 65%, ${Math.max(p.life/110,0)})`;
        ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
        ctx.fill();
      }
      requestAnimationFrame(tickFW);
    }

    yesBtn.addEventListener("click", () => {
      noFly.style.display = "none";

      fw.style.display = "block";
      resizeFW();

      wrap.style.display = "none";
      stage.innerHTML = `
        <div class="final-screen">
          <div class="final-text left">–æ–π, –∫–∞–∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æüò≥</div>
          <img class="final-photo" src="./IMG_9008.PNG" alt="">
          <div class="final-text right">–Ω–æ —Ç—ã –º–Ω–µ —Ç–æ–∂–µ –Ω—Ä–∞–≤–∏—à—å—Å—èü´¶</div>
        </div>
      `;

      const start = performance.now();
      const interval = isMobile ? 140 : 180;

      (function loop(t){
        if (t - start < 8500){
          burst(
            60 + Math.random()*(window.innerWidth - 120),
            70 + Math.random()*(window.innerHeight * 0.55)
          );
          setTimeout(()=>requestAnimationFrame(loop), interval);
        }
      })(start);

      requestAnimationFrame(tickFW);
    });

    window.addEventListener("resize", () => {
      if (fw.style.display !== "none") resizeFW();
    });
  </script>
</body>
</html>
